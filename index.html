<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Libp2p Browser Test</title>
    <script type="module">
        import { createLibp2p } from 'libp2p'
        import { webSockets } from '@libp2p/websockets'
        import { noise } from '@chainsafe/libp2p-noise'
        import { yamux } from '@chainsafe/libp2p-yamux'
        import { bootstrap } from '@libp2p/bootstrap'

        // Use your relay node's WebSocket address
        const relayMultiaddr = '12D3KooWJWxeaohBhiA1RrhSQ4xjbKF8W9qg5nFi1t9pbC2N8t1e'

        async function createNode() {
          const node = await createLibp2p({
            transports: [webSockets()],
            connectionEncrypters: [noise()],
            streamMuxers: [yamux()],
            peerDiscovery: [
              bootstrap({
                list: [relayMultiaddr] // Connect to relay node
              }),
              mdns()
            ]
          })

          await node.start()
          console.log('Browser node started!')

          node.addEventListener('peer:discovery', async (evt) => {
            console.log('Discovered:', evt.detail.id.toString())
            try {
              await node.dial(evt.detail.id) // Connect to discovered peer
              console.log('Connected to:', evt.detail.id.toString())
            } catch (err) {
              console.error('Failed to connect:', err)
            }
          })
        }

        createNode()
    </script>
</head>
<body>
    <h1>Libp2p Browser P2P Test</h1>
    <p>Open this page in multiple browser instances to test peer discovery.</p>
</body>
</html>